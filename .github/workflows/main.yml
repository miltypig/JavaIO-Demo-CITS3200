name: Deploy To Server on Main Push.

on:
  push:
    branches: [ main ]

jobs:
 deploy:
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v2
   
   - name: Install SSH key
     uses: shimataro/ssh-key-action@v2
     with:
       key: ${{ secrets.SSH_PRIVATE_KEY }}
       known_hosts: ${{ secrets.KNOW_HOST }}
       
   - name: deploy code
     uses: appleboy/ssh-action@master
     with:
          host: 194.195.253.84
          username: testing
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22
          script: |
            cd /home/testing/AgentServer/JavaIO-Demo-CITS3200
            git fetch origin 
            git reset --hard FETCH_HEAD
            git clean -d -f --exclude secrets
